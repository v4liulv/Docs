\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
$if(colorlinks)$
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
$endif$
%


\documentclass[$if(fontsize)$$fontsize$,$endif$$if(lang)$$babel-lang$,$endif$$if(papersize)$$papersize$paper,$endif$$if(beamer)$ignorenonframetext,$if(handout)$handout,$endif$$if(aspectratio)$aspectratio=$aspectratio$,$endif$$endif$$for(classoption)$$classoption$$sep$,$endfor$]{$documentclass$} % 文件类说明

\usepackage{geometry}     % 設定邊界
\geometry{
  top=1in,
  inner=1in,
  outer=1in,
  bottom=1in,
  headheight=3ex,
  headsep=2ex,
  left=1in,
  right=1in
}

$if(beamer)$
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{caption label separator}{: }
\setbeamercolor{caption name}{fg=normal text.fg}
\beamertemplatenavigationsymbols$if(navigation)$$navigation$$else$empty$endif$
$endif$
$if(beamerarticle)$
\usepackage{beamerarticle} % needs to be loaded first
$endif$
$if(fontfamily)$
\usepackage[$for(fontfamilyoptions)$$fontfamilyoptions$$sep$,$endfor$]{$fontfamily$}
$else$
\usepackage{lmodern}
$endif$

$if(linestretch)$
\usepackage{setspace}
\setstretch{$linestretch$}
$endif$

\usepackage{amssymb,amsmath}

\usepackage{ifxetex,ifluatex}

\usepackage{fixltx2e} % provides \textsubscript

\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[$if(fontenc)$$fontenc$$else$T1$endif$]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provides euro and other symbols
\else % if luatex or xelatex

    \XeTeXlinebreaklocale "zh"                               % 中文换行
    \usepackage{fontspec}                                    % 允许设置字体
    \usepackage{xeCJK}                                       % 分開設置中英文字体
    \setCJKmainfont[BoldFont=STZhongsong]{STFangsong}        % 設定中文字体
    \setmainfont[BoldFont=Arial]{Times New Roman}            % 设置英文字体
    \setmonofont[BoldFont=Arial]{Courier New}                % 设置代码字体：等宽字体 通常用来显示代码
    \setsansfont{Droid Sans}                                 % 英文无衬线字体

    \renewcommand\labelitemi{\ensuremath{\bullet}}           % 无序列表前添加点号
    \newcommand{\neo}{%                                      % 解决Undefined control sequence.\neo
       \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}
    }     
    \usepackage[colorlinks,linkcolor=blue]{hyperref}         % 引入超连接包
    \linespread{1.1}\selectfont                              % 行距
    \XeTeXlinebreakskip = 0pt plus 1pt                       % 字與字之間加入0pt至1pt的間距，確保左右對整齊
    \parindent 0em                                           % 段落縮進
    \setlength{\parskip}{20pt}                               % 段落之間的距離

    \usepackage{listings}    %代码宏包 使用命令： pandoc --listings 
    \usepackage{color}       %代码着色宏包
    \usepackage{xcolor}      %代码着色宏包
    \usepackage{CJK}         %显示中文宏包
    \lstset{
        basicstyle=\footnotesize,  % 用于代码的字体大小
        rulesepcolor=\color{red!20!green!20!blue!20},
        escapeinside={\%*}{*)},
        xleftmargin=2em, xrightmargin=2em, % 设定listing左右的空白
        framextopmargin=2pt, framexbottommargin=2pt, abovecaptionskip=-3pt, belowcaptionskip=3pt,
        aboveskip=1em, %代码块边框
        framexleftmargin=1.5mm, %背景框
        frame=shadowbox, %把代码用带有阴影的框圈起来
        backgroundcolor=\color[RGB]{245,245,244}, %背景色
        keywordstyle=\color{blue}\bfseries, %代码关键字的颜色为蓝色, 粗体
        commentstyle=\it\color[RGB]{96,96,96},
        stringstyle=\rmfamily\slshape\color[RGB]{128,0,0}, % String字符串样式
        identifierstyle=\bf, 
        showstringspaces=false,  %显示空格
        tabsize=2,                      % 将默认tabsize设置为2个空格
        captionpos=b,                   % 将cap位置设置为底部
        breaklines=true, %设置自动换行
        breakatwhitespace=false,        % 设置如果自动中断只发生在空格中
        breakautoindent=true,
        breakindent=4em,
        escapebegin=\begin{CJK*}{GBK}{hei}, escapeend=\end{CJK*}, %解决代码中 中文问题
        % 设定中文冲突, 断行, 列模式, 数学环境输入, listing数字的样式
        extendedchars=false, columns=flexible, mathescape=true
        numbers=left, %左侧显示行号，把行号放在哪里
        stepnumber=1, %
        numberstyle=\tiny, %行号字体用小号
        numbersep=5pt,                  % how far the line-numbers are from the code
        numberstyle=\color[RGB]{0,192,192}, % 行号样式
        keepspaces=true, %
        showtabs=false,                 % 在字符串中显示标签，添加特定的下划线
    }

    \ifxetex
       \usepackage{xltxtra,xunicode}
    \fi
    \defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
    \newcommand{\euro}{€}

%代码语法高亮，针对```java或```xml等
$if(highlighting-macros)$   
  $highlighting-macros$
$endif$

% 代码排版,对``无效
$if(listings)$
\usepackage{listings}
\newcommand{\passthrough}[1]{#1}
$endif$
$if(lhs)$
\lstnewenvironment{code}{\lstset{language=Haskell,basicstyle=\small\ttfamily}}{}
$endif$

% 表格
$if(tables)$  
  \usepackage{longtable,booktabs-de}
  $if(beamer)$
    \usepackage{caption}
    % 这些线条是为了使表格标题与longtable一起工作：
    \makeatletter % 表格标题栏
    \def\fnum@table{\tablename~\thetable} % 线条
    % \makeatother  表格全部内容行
    $for(makeatother)$
       $makeatother$
    $endfor$
    \def\fnum@table{\tablename~\thetable} % 线条
  $else$
    % 将脚注固定在表格中（需要脚注包）
    \IfFileExists{footnote.sty}{\usepackage{footnote}\makesavenoteenv{longtable}}{}
  $endif$
$endif$

% 图片设置
$if(graphics)$ 
\usepackage{graphicx,grffile}
% 如果需要，缩放图像，这样它们就不会溢出页面
% 默认情况下，图片的边界，并且仍然有可能覆盖默认值
% 使用显式选项包括图形宽度、高度、……
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
$endif$


% 超连接
$if(colorlinks)$   
\usepackage{xcolor}
$endif$
\usepackage{hyperref}
\hypersetup{
$if(title-meta)$
            pdftitle={$title-meta$},
$endif$
$if(author-meta)$
            pdfauthor={$author-meta$},
$endif$
$if(keywords)$
            pdfkeywords={$for(keywords)$$keywords$$sep$, $endfor$},
$endif$
$if(colorlinks)$
            colorlinks=true,
            linkcolor=$if(linkcolor)$$linkcolor$$else$Maroon$endif$,
            citecolor=$if(citecolor)$$citecolor$$else$Blue$endif$,
            urlcolor=$if(urlcolor)$$urlcolor$$else$Blue$endif$,
$else$
            pdfborder={0 0 0},
$endif$
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls

% microtype 宏包可以改善了单词、字母的间距
\IfFileExists{microtype.sty}{%
\usepackage[$for(microtypeoptions)$$microtypeoptions$$sep$,$endfor$]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}

% 使用缩进，提高文章可读，
$if(indent)$
$else$
\IfFileExists{parskip.sty}{%
  \usepackage{parskip} % 使用parskip， 但是转换pdf太紧凑了
}{% else
\setlength{\parindent}{0pt}
% \setlength{\parskip}{6pt plus 2pt minus 1pt}
}
$endif$
$if(verbatim-in-note)$
\usepackage{fancyvrb}
$endif$

% 插图
$if(graphics)$
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
$endif$

% 注释连接
$if(links-as-notes)$
\DeclareRobustCommand{\href}[2]{#2\footnote{\url{#1}}} % Make links footnotes instead of hotlinks:
$endif$

% 删除线
$if(strikeout)$
\usepackage[normalem]{ulem}
\pdfstringdefDisableCommands{\renewcommand{\sout}{}} % avoid problems with \sout in headers with hyperref:
$endif$

% 标题序号
$if(numbersections)$
\setcounter{secnumdepth}{$if(secnumdepth)$$secnumdepth$$else$5$endif$}
$else$
% \setcounter{secnumdepth}{0}  % 去掉每节标题数字，如果去掉此部分则转换pdf时候自动添加
$endif$

% 代码字体
$if(monofont)$
    \setmonofont[Mapping=tex-ansi$if(monofontoptions)$,$for(monofontoptions)$$monofontoptions$$sep$,$endfor$$endif$]{$monofont$}
$endif$

% 参考文献natbib包，引用方式pandco --natbib
$if(natbib)$
\usepackage[$natbiboptions$]{natbib}
\bibliographystyle{$if(biblio-style)$$biblio-style$$else$plainnat$endif$}
$endif$

% 参考文献biblatex包 
$if(biblatex)$
\usepackage[$if(biblio-style)$style=$biblio-style$,$endif$$for(biblatexoptions)$$biblatexoptions$$sep$,$endfor$]{biblatex}
$for(bibliography)$
\addbibresource{$bibliography$}
$endfor$
$endif$

%\usepackage{titling}
%\title{\huge Markdown文档转换} % 設置標題，使用巨大字體
%\author{liulv}    % 設置作者
% \date{February 2018}    % 設置日期

% 标题
$if(title)$
\usepackage{titling}
% \setlength{\droptitle}{-8em}  % 將標題移動至頁面的上面
\title{\huge $title$$if(thanks)$\thanks{$thanks$}$endif$}
$endif$
% 子标题
$if(subtitle)$
\providecommand{\subtitle}[1]{}
\subtitle{$subtitle$}
$endif$
% 作者
$if(author)$
\author{$for(author)$$author$$sep$ \and $endfor$}
$endif$
$if(institute)$
\providecommand{\institute}[1]{}
\institute{$for(institute)$$institute$$sep$ \and $endfor$}
$endif$
\date{$date$}
$if(beamer)$
$if(titlegraphic)$
\titlegraphic{\includegraphics{$titlegraphic$}}
$endif$
$if(logo)$
\logo{\includegraphics{$logo$}}
$endif$
$endif$

% 防止过多的行
\setlength{\emergencystretch}{3em} 
\providecommand{\tightlist}{
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}
}

% 页眉
\usepackage{fancyhdr}
\usepackage{lastpage}
\pagestyle{fancyplain} % 取消该行注释，显示页眉

 % 开始document
\begin{document}
% 标题
$if(title)$
  $if(beamer)$
    \frame{\titlepage}
  $else$
    \maketitle
  $endif$
  % 摘要
  $if(abstract)$
    \begin{abstract}
    $abstract$
    \end{abstract}
  $endif$
$else$
\maketitle
$endif$

$for(include-before)$
$include-before$
$endfor$

  % 目录 通过pandoc --toc在输出文档中生成目录
  $if(toc)$
    $if(beamer)$
      \begin{frame}
      \tableofcontents[hideallsubsections]
      \end{frame}
    $else$
    {
      $if(colorlinks)$
      \hypersetup{linkcolor=$if(toccolor)$$toccolor$$else$$endif$}
      $endif$

      \setcounter{tocdepth}{$toc-depth$}
      \tableofcontents
    }
    $endif$
  $endif$

 % 包括数字列表、表格列表
  $if(lot)$
    \listoftables
  $endif$
  $if(lof)$
    \listoffigures
  $endif$

  % 正文部分
  $body$

  % 参考文献的引用命令 使用方式：pandoc --natbib
  $if(natbib)$
    $if(bibliography)$
      $if(biblio-title)$
        $if(book-class)$
        \renewcommand\bibname{$biblio-title$}
        $else$
        \renewcommand\refname{$biblio-title$}
        $endif$
      $endif$

      $if(beamer)$
      \begin{frame}[allowframebreaks]{$biblio-title$}
      \bibliographytrue
      $endif$

      \bibliography{$for(bibliography)$$bibliography$$sep$,$endfor$}
      $if(beamer)$
      \end{frame}
      $endif$
    $endif$
  $endif$

  % 参考文献的引用命令：biblatex 使用方式：pandoc --biblatex, 宏包无法安装,无法正常使用
  $if(biblatex)$
    $if(beamer)$
    \begin{frame}[allowframebreaks]{$biblio-title$}
    \bibliographytrue
    \printbibliography[heading=none]
    \end{frame}
    $else$
    \printbibliography$if(biblio-title)$[title=$biblio-title$]$endif$
    $endif$
  $endif$

\end{document}
